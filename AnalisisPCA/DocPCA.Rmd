---
title: "Analisis PCA"
author:
- Carlos Garcia Diaz
- Leonardo Cortez Gomez
date: "`r Sys.Date()`"
output:
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

# Declaración del problema

## Descripción del conjunto de datos

El conjunto de datos sobre isótopos de carbono es un conjunto de datos multivariados de valor real que describe la criticidad (*K*) de un reactor y la potencia del mismo (*LP*).

Hay ciento doce columnas. Las primeras 110 se refieren a isótopos de carbono, donde *C* hace referencia al Carbono, el número después de la *C* a la cantidad de protones y neutrones en su núcleo, *U* a que es *inestable*, y *G* a que es emisor de *radiación gamma*. Por último, la columna *K* se refiere a la criticidad del reactor, y la columna *LP* a la potencia de este.

El objetivo del presente análisis es resumir y visualizar la información útil de todo el conjunto de datos con una pérdida mínima de la información, ya que hacer un análisis de 112 variables sería muy complicado. Para ello primero se observará la correlación de los datos, pues **si los datos están altamente correlacionados, significa que hay redundancia y que pueden ser reducidos a un conjunto más pequeño de datos (dimensiones)**.

# Análisis

## Importación del conjunto de datos

```{r}
library("readxl")
library('corrr')
library("ggcorrplot")
library("FactoMineR")
library("factoextra")
```

Vista previa del conjunto de datos.

```{r}
datos <- read_excel("dataframe_inicial.xlsx")
str(datos)
```

## Limpieza de los datos

En esta etapa, debe asegurarse de deshacerse de todas las inconsistencias, como valores faltantes y variables redundantes.

Verificamos si hay valores nulos.

```{r}
colSums(is.na(datos))
```

No hay datos nulos.

Por otra parte, previamente se identificaron columnas con valores 0, por lo tanto, se decide no tomarlas en cuenta para el estudio ya que no aportan nada a este.

```{r}
datos = datos[, which(colSums(datos) != 0)]
str(datos)
```

Con esto, nos quedan 57 columnas.

## Normalización de los datos

Con el fin de que las variables estén dentro del mismo rango (escala) y contribuyan igualmente al análisis, se someten a un proceso de estandarización.

Primero, se descartan las columnas *K* y *LP* por no ser relevantes en este estudio.

```{r}
numerical_data <- datos[,0:55]
head(numerical_data)
```

Se estandarizan los datos:

```{r}
data_normalized <- scale(numerical_data)
head(data_normalized)
```

Debido a que ciertas columnas contenían el mismo valor en todos sus registros, el resultado de la estandarización es nulo.
A continuación, se identificaron datos nulos en las columnas *C11U*, *C32G*, *C82G*, *C93G* y *C98G*, por lo que no se tomarán en cuenta.

```{r}
colSums(is.na(data_normalized))
```

Una vez identificadas dichas columnas, se eliminan del conjunto de datos.

```{r}
data_normalized = data_normalized[, colSums(is.na(data_normalized)) == 0]

str(data_normalized)
```

## Computar la matriz de correlación

Ya con los datos limpios y estandarizados, se muestra la matriz de correlación.

```{r echo = FALSE}
corr_matrix <- cor(data_normalized)
ggcorrplot(corr_matrix) +
  theme(axis.text.x = element_text(size = 6, angle = 90),
        axis.text.y = element_text(size = 6))
```

Correlación positiva o negativa.

## PCA

Se "construyen" nuevas variables a partir de combinaciones lineales o mezclas de las variables iniciales.

```{r}
datos.pca <- princomp(corr_matrix)
str(datos.pca)
```

```{r}
datos.pca$loadings[, 1:2]
```

Como se muestra en la siguiente gráfica, el primer componente contiene la máxima información posible de las variables, representándolas en hasta un 62.6%

```{r echo = FALSE}
fviz_eig(datos.pca, addlabels = TRUE)
```

De forma geométrica se muestra que los componentes principales representan las direcciones de los datos que explican la máxima cantidad de varianza. En el caso del primer componente se aprecia que, en la siguiente gráfica, las *líneas* que representan a las variables originales tienden a agruparse en el eje *x*, correspondiente a la *dimensión 1*.

```{r echo = FALSE}
fviz_pca_var(datos.pca, col.var = "blacK")
```

### Calidad de la representación

Así mismo podemos ver la calidad de la representación de las variables originales en los componentes principales obtenidos, como se muestra a continuación:

```{r echo = FALSE}
fviz_cos2(datos.pca, choice = "var", axes = 1:2) +
  theme(axis.text.x = element_text(size = 8))
```

Por ejemplo, el isótopo *C98U* es bien representado en la componente principal, seguido de los isótopos *C101U* y *C92*.

También podemos ver la calidad de representación de cada variable en el siguiente gráfico a través de un esquemma de colores.

```{r echo = FALSE}
fviz_pca_var(datos.pca, col.var = "cos2",
            gradient.cols = c("black", "orange", "green"),
            repel = TRUE)
```

